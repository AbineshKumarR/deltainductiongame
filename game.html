<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Titan's Circuit | Game</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background-color: black;
      color: white;
    }

    .hedr {
      display: flex;
      height: 100px;
    }

    .hedr > div {
      flex: 1;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .hedrblue { 
		  background-color: DodgerBlue; 
	  }

    .hedrgrey { 
		  background-color: orange; 
		  flex: 1.5; 
	  }

    .hedrred { 
		  background-color: red; 
	  }

    .circuit {
      height: calc(100% - 100px);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @media (max-width: 768px) {
      .circuit {
        width: 100%;
        height: auto;
      }
    }

    svg {
      max-height: 100%;
      max-width: 100%;
    }

    circle {
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="hedr">
    <div class="hedrblue">
      <h3>BLUE</h3>
      <h3>POINTS - <span id="bpts">0</span></h3>
    </div>
    <div class="hedrgrey">
      <h2 id="turn" style="color: dodgerblue;">Blue to play</h2>
      <h3>TIME LEFT - <span style="color: dodgerblue;">BLUE</span> <span id="btimer">02:00</span> || <span style="color: red;">RED</span> <span id="rtimer">02:00</span></h3>
    </div>
    <div class="hedrred">
      <h3>RED</h3>
      <h3>POINTS - <span id="rpts">0</span></h3>
    </div>
  </div>

  <div class="circuit">
    <svg viewBox="0 0 540 300" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
      <line class="ho" id="ho1" stroke="white" stroke-width="1.5" x1="120" y1="150" x2="200" y2="40" data-from="co1" data-to="co2" data-value="2"/>
      <line class="ho" id="ho2" stroke="white" stroke-width="1.5" x1="200" y1="40" x2="340" y2="40" data-from="co2" data-to="co3" data-value="1"/>
      <line class="ho" id="ho3" stroke="white" stroke-width="1.5" x1="340" y1="40" x2="420" y2="150" data-from="co3" data-to="co4" data-value="2"/>
      <line class="ho" id="ho4" stroke="white" stroke-width="1.5" x1="420" y1="150" x2="340" y2="260" data-from="co4" data-to="co5" data-value="1"/>
      <line class="ho" id="ho5" stroke="white" stroke-width="1.5" x1="340" y1="260" x2="200" y2="260" data-from="co5" data-to="co6" data-value="1"/>
      <line class="ho" id="ho6" stroke="white" stroke-width="1.5" x1="200" y1="260" x2="120" y2="150" data-from="co6" data-to="co1" data-value="3"/>

      <line class="hm" id="hm1" stroke="white" stroke-width="1.5" x1="160" y1="150" x2="220" y2="70" data-from="cm1" data-to="cm2" data-value="5"/>
      <line class="hm" id="hm2" stroke="white" stroke-width="1.5" x1="220" y1="70" x2="320" y2="70" data-from="cm2" data-to="cm3" data-value="6"/>
      <line class="hm" id="hm3" stroke="white" stroke-width="1.5" x1="320" y1="70" x2="380" y2="150" data-from="cm3" data-to="cm4" data-value="4"/>
      <line class="hm" id="hm4" stroke="white" stroke-width="1.5" x1="380" y1="150" x2="320" y2="230" data-from="cm4" data-to="cm5" data-value="5"/>
      <line class="hm" id="hm5" stroke="white" stroke-width="1.5" x1="320" y1="230" x2="220" y2="230" data-from="cm5" data-to="cm6" data-value="6"/>
      <line class="hm" id="hm6" stroke="white" stroke-width="1.5" x1="220" y1="230" x2="160" y2="150" data-from="cm6" data-to="cm1" data-value="4"/>
        
      <line class="hi" id="hi1" stroke="white" stroke-width="1.5" x1="200" y1="150" x2="240" y2="100" data-from="ci1" data-to="ci2" data-value="8"/>
      <line class="hi" id="hi2" stroke="white" stroke-width="1.5" x1="240" y1="100" x2="300" y2="100" data-from="ci2" data-to="ci3" data-value="8"/>
      <line class="hi" id="hi3" stroke="white" stroke-width="1.5" x1="300" y1="100" x2="340" y2="150" data-from="ci3" data-to="ci4" data-value="9"/>
      <line class="hi" id="hi4" stroke="white" stroke-width="1.5" x1="340" y1="150" x2="300" y2="200" data-from="ci4" data-to="ci5" data-value="8"/>
      <line class="hi" id="hi5" stroke="white" stroke-width="1.5" x1="300" y1="200" x2="240" y2="200" data-from="ci5" data-to="ci6" data-value="8"/>
      <line class="hi" id="hi6" stroke="white" stroke-width="1.5" x1="240" y1="200" x2="200" y2="150" data-from="ci6" data-to="ci1" data-value="9"/>

      <line id="p1" stroke="white" stroke-width="1.5" x1="160" y1="150" x2="120" y2="150" data-from="co1" data-to="cm1" data-value="1"/>
      <line id="p2" stroke="white" stroke-width="1.5" x1="220" y1="70" x2="240" y2="100" data-from="cm2" data-to="ci2" data-value="1"/>        
      <line id="p3" stroke="white" stroke-width="1.5" x1="320" y1="70" x2="340" y2="40" data-from="co3" data-to="cm3" data-value="1"/>
      <line id="p4" stroke="white" stroke-width="1.5" x1="380" y1="150" x2="340" y2="150" data-from="cm4" data-to="ci4" data-value="1"/>
      <line id="p5" stroke="white" stroke-width="1.5" x1="320" y1="230" x2="340" y2="260" data-from="co5" data-to="cm5" data-value="1"/>
      <line id="p6" stroke="white" stroke-width="1.5" x1="220" y1="230" x2="240" y2="200" data-from="cm6" data-to="ci6" data-value="1"/>
      	    
      <circle class="c o" id="co1" onclick="handleCircle('co1')" stroke="white" stroke-width="2.5" cx="120" cy="150" r="7" fill="grey" />
      <circle class="c o" id="co2" onclick="handleCircle('co2')" stroke="white" stroke-width="2.5" cx="200" cy="40" r="7" fill="grey" />
      <circle class="c o" id="co3" onclick="handleCircle('co3')" stroke="white" stroke-width="2.5" cx="340" cy="40" r="7" fill="grey" />
      <circle class="c o" id="co4" onclick="handleCircle('co4')" stroke="white" stroke-width="2.5" cx="420" cy="150" r="7" fill="grey" />
      <circle class="c o" id="co5" onclick="handleCircle('co5')" stroke="white" stroke-width="2.5" cx="340" cy="260" r="7" fill="grey" />
      <circle class="c o" id="co6" onclick="handleCircle('co6')" stroke="white" stroke-width="2.5" cx="200" cy="260" r="7" fill="grey" />

      <circle class="c m" id="cm1" onclick="handleCircle('cm1')" stroke="white" stroke-width="2.5" cx="160" cy="150" r="7" fill="grey" />
      <circle class="c m" id="cm2" onclick="handleCircle('cm2')" stroke="white" stroke-width="2.5" cx="220" cy="70" r="7" fill="grey" />
      <circle class="c m" id="cm3" onclick="handleCircle('cm3')" stroke="white" stroke-width="2.5" cx="320" cy="70" r="7" fill="grey" />
      <circle class="c m" id="cm4" onclick="handleCircle('cm4')" stroke="white" stroke-width="2.5" cx="380" cy="150" r="7" fill="grey" />
      <circle class="c m" id="cm5" onclick="handleCircle('cm5')" stroke="white" stroke-width="2.5" cx="320" cy="230" r="7" fill="grey" />
      <circle class="c m" id="cm6" onclick="handleCircle('cm6')" stroke="white" stroke-width="2.5" cx="220" cy="230" r="7" fill="grey" />

      <circle class="c i" id="ci1" onclick="handleCircle('ci1')" stroke="white" stroke-width="2.5" cx="200" cy="150" r="7" fill="grey" />
      <circle class="c i" id="ci2" onclick="handleCircle('ci2')" stroke="white" stroke-width="2.5" cx="240" cy="100" r="7" fill="grey" />
      <circle class="c i" id="ci3" onclick="handleCircle('ci3')" stroke="white" stroke-width="2.5" cx="300" cy="100" r="7" fill="grey" />
      <circle class="c i" id="ci4" onclick="handleCircle('ci4')" stroke="white" stroke-width="2.5" cx="340" cy="150" r="7" fill="grey" />
      <circle class="c i" id="ci5" onclick="handleCircle('ci5')" stroke="white" stroke-width="2.5" cx="300" cy="200" r="7" fill="grey" />
      <circle class="c i" id="ci6" onclick="handleCircle('ci6')" stroke="white" stroke-width="2.5" cx="240" cy="200" r="7" fill="grey" />

      <text x="270" y="35" fill="lime" font-size="12" class="to" data-line="ho2" text-anchor="middle">1</text>
      <text x="390" y="95" fill="lime" font-size="12" class="to" data-line="ho3" text-anchor="middle">2</text>
      <text x="390" y="215" fill="lime" font-size="12" class="to" data-line="ho4" text-anchor="middle">1</text>
      <text x="270" y="275" fill="lime" font-size="12" class="to" data-line="ho5" text-anchor="middle">1</text>
      <text x="150" y="215" fill="lime" font-size="12" class="to" data-line="ho6" text-anchor="middle">3</text>
      <text x="150" y="95" fill="lime" font-size="12" class="to" data-line="ho1" text-anchor="middle">2</text>

      <text x="270" y="65" fill="lime" font-size="12" class="tm" data-line="hm2" text-anchor="middle">6</text>
      <text x="360" y="115" fill="lime" font-size="12" class="tm" data-line="hm3" text-anchor="middle">4</text>
      <text x="360" y="195" fill="lime" font-size="12" class="tm" data-line="hm4" text-anchor="middle">5</text>
      <text x="270" y="245" fill="lime" font-size="12" class="tm" data-line="hm5" text-anchor="middle">6</text>
      <text x="180" y="195" fill="lime" font-size="12" class="tm" data-line="hm6" text-anchor="middle">4</text>
      <text x="180" y="115" fill="lime" font-size="12" class="tm" data-line="hm1" text-anchor="middle">5</text>

      <text x="270" y="95" fill="lime" font-size="12" class="ti" data-line="hi2" text-anchor="middle">8</text>
      <text x="330" y="125" fill="lime" font-size="12" class="ti" data-line="hi3" text-anchor="middle">9</text>
      <text x="330" y="185" fill="lime" font-size="12" class="ti" data-line="hi4" text-anchor="middle">8</text>
      <text x="270" y="215" fill="lime" font-size="12" class="ti" data-line="hi5" text-anchor="middle">8</text>
      <text x="210" y="185" fill="lime" font-size="12" class="ti" data-line="hi6" text-anchor="middle">9</text>
      <text x="210" y="125" fill="lime" font-size="12" class="ti" data-line="hi1" text-anchor="middle">8</text>

      <text x="140" y="145" fill="lime" font-size="12" text-anchor="middle">1</text>
      <text x="240" y="85" fill="lime" font-size="12" text-anchor="middle">1</text>
      <text x="340" y="65" fill="lime" font-size="12" text-anchor="middle">1</text>
      <text x="360" y="165" fill="lime" font-size="12" text-anchor="middle">1</text>
      <text x="320" y="250" fill="lime" font-size="12" text-anchor="middle">1</text>
      <text x="240" y="225" fill="lime" font-size="12" text-anchor="middle">1</text>

    </svg>
  </div>
  
  <script>
    var x = 0;
    var select = null;
    var colour = "DodgerBlue";
    var outer = 0;
    var middle = 0;
    var phase = "placement";
  
    var outerid = ["co1", "co2", "co3", "co4", "co5", "co6"];
    var middleid = ["cm1", "cm2", "cm3", "cm4", "cm5", "cm6"];
    var innerid = ["ci1", "ci2", "ci3", "ci4", "ci5", "ci6"];

    var outerlid = ["ho1", "ho2", "ho3", "ho4", "ho5", "ho6"];
    var middlelid = ["hm1", "hm2", "hm3", "hm4", "hm5", "hm6"];
    var innerlid = ["hi1", "hi2", "hi3", "hi4", "hi5", "hi6"];

    var tia, tib;
    var tb = 0, tr = 0;
    var dur = 0;
    var bmove = true;
    var running = false;

    var adjacency = {
      co1: ["co2", "co6", "cm1"],
      co2: ["co1", "co3"],
      co3: ["co2", "co4", "cm3"],
      co4: ["co3", "co5"],
      co5: ["co4", "co6", "cm5"],
      co6: ["co5", "co1"],
  
      cm1: ["cm2", "cm6", "co1"],
      cm2: ["cm1", "cm3", "ci2"],
      cm3: ["cm2", "cm4", "co3"],
      cm4: ["cm3", "cm5", "ci4"],
      cm5: ["cm4", "cm6", "co5"],
      cm6: ["cm5", "cm1", "ci6"],
  
      ci1: ["ci2", "ci6"],
      ci2: ["ci1", "ci3", "cm2"],
      ci3: ["ci2", "ci4"],
      ci4: ["ci3", "ci5", "cm4"],
      ci5: ["ci4", "ci6"],
      ci6: ["ci5", "ci1", "cm6"]
    };

    function ro(lid) {
      var l = document.getElementById(lid);
      var txt = document.getElementsByClassName("to");
      var rand = Math.floor(Math.random() * 3) + 1;
      for (var j = 0; j < txt.length; j++) {
        var tid = txt[j].getAttribute("data-line");
        if (lid === tid) {
          l.setAttribute("data-value", rand);
          txt[j].textContent = rand;
        }
      }
    }
  
    function rm(lid) {
      var l = document.getElementById(lid);
      var txt = document.getElementsByClassName("tm");
      var rand = Math.floor(Math.random() * 3) + 4;
      for (var j = 0; j < txt.length; j++) {
        var tid = txt[j].getAttribute("data-line");
        if (lid === tid) {
          l.setAttribute("data-value", rand);
          txt[j].textContent = rand;
        }
      }
    }
  
    function ri(lid) {
      var l = document.getElementById(lid);
      var txt = document.getElementsByClassName("ti");
      var rand = Math.floor(Math.random() * 3) + 7;
      for (var j = 0; j < txt.length; j++) {
        var tid = txt[j].getAttribute("data-line");
        if (lid === tid) {
          l.setAttribute("data-value", rand);
          txt[j].textContent = rand;
        }
      }
    }
    window.onload = function () {
      outerlid.forEach(ro);
      middlelid.forEach(rm);
      innerlid.forEach(ri);
    }

    function format(t) {
      var m = Math.floor(t / 60);
      var s = t % 60;
      return (m < 10 ? "0" : "") + m + ":" + (s < 10 ? "0" : "") + s;
    }

    function display() {
      document.getElementById("btimer").textContent = format(tb);
      document.getElementById("rtimer").textContent = format(tr);
    }

    function start(duration) {
      clearAll();
      dur = duration;
      tb = duration;
      tr = duration;
      bmove = true;
      running = true;
      display();
      tia = setInterval(runb, 1000);
    }

    function runr() {
      if (--tb < 0) {
        gameover("BLUE");
      } else {
        display();
      }
    }

    function runb() {
      if (--tr < 0) {
        gameover("RED");
      } else {
        display();
      }
    }

    function toggle() {
      if (!running) 
        return;

      if (bmove) {
        clearInterval(tia);
        tib = setInterval(runr, 1000);
      } else {
        clearInterval(tib);
        tia = setInterval(runb, 1000);
      }

      bmove = !bmove;
    }

    function gameover(player) {
      clearAll();
      alert("Game Over! " + player + "has won the game");
      location.reload();
    }

    function clearAll() {
      clearInterval(tia);
      clearInterval(tib);
    }

    function points() {
      var bluePoints = 0;
      var redPoints = 0;

      var lines = document.querySelectorAll("line");

      for (var i = 0; i < lines.length; i++) {
        var line = lines[i];
        var id1 = line.getAttribute("data-from");
        var id2 = line.getAttribute("data-to");

        var circle1 = document.getElementById(id1);
        var circle2 = document.getElementById(id2);

        var fill1 = circle1.getAttribute("fill");
        var fill2 = circle2.getAttribute("fill");

        if (fill1 === fill2 && (fill1 === "DodgerBlue" || fill1 === "Tomato")) {
          var value = parseInt(line.getAttribute("data-value")) || 0;
          if (fill1 === "DodgerBlue") {
            bluePoints += value;
          } else {
            redPoints += value;
          }
        }
      }

      document.getElementById("bpts").innerText = bluePoints;
      document.getElementById("rpts").innerText = redPoints;
    }


    function swaps() {
      colour = (colour === "DodgerBlue") ? "Tomato" : "DodgerBlue";
      document.getElementById("turn").innerText = (colour === "DodgerBlue") ? "Blue to play" : "Red to play";
      document.getElementById("turn").style.color = (colour === "DodgerBlue") ? "DodgerBlue" : "Red";
      points();
      if (x === 0) {
        start(120);
        x = 1;
      }
      else if (select === null){
        toggle();
      }
    }

    function innerfilled() {
      var inner = 0;
      for (var i = 0; i < 6; i++) {
        var c = document.getElementById(innerid[i]);
        var fill = c.getAttribute('fill');
        if (fill !== 'grey') {
          inner++;
        }
      }
      if (inner === 6){
        var b = Number(document.getElementById("bpts"));
        var r = Number(document.getElementById("rpts"));
        var p;
        p = (b > r) ? "BLUE" : "RED";
        if (b === r){
          window.alert("GAME OVER. It is a DRAW");
          return;
        }
        window.alert("GAME OVER. " + p + " has won the game");
        location.reload();
      }
    }
  
    function handleCircle(id) {
      var circle = document.getElementById(id);
      var currentFill = circle.getAttribute("fill");
  
      if (phase === "placement") {
        if (outer < 6 && outerid.includes(id)) {
          if (currentFill === "grey") {
            circle.setAttribute("fill", colour);
            outer++;
            swaps();
            return;
          }
        }
  
        else if (outer === 6 && middle < 2 && middleid.includes(id)) {
          if (currentFill === "grey") {
            circle.setAttribute("fill", colour);
            middle++;
            if (middle === 2) {
              phase = "movement";
            }
            swaps();
            return;
          }
        }
      }
  
      else if (phase === "movement") {
        if (select === null) {
          if (currentFill === colour) {
            select = id;
            circle.setAttribute("stroke", "yellow");
          }
        } else {
          if (id === select) {
            circle.setAttribute("stroke", "white");
            select = null;
            return;
          }
  
          if (currentFill === "grey" && adjacency[select].includes(id)) {
            document.getElementById(select).setAttribute("fill", "grey");
            document.getElementById(select).setAttribute("stroke", "white");
  
            circle.setAttribute("fill", colour);
            select = null;
            swaps();
            innerfilled();
          }
        }
      }
    }

  </script>
  

</body>
</html>

